<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Storia degli Stili</title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,400">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lobster">
  <link rel="stylesheet" href="/assets/bootstrap-3.3.5-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/assets/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/assets/css/animate.css">
  <link rel="stylesheet" href="/assets/css/magnific-popup.css">
  <link rel="stylesheet" href="/assets/flexslider/flexslider.css">
  <link rel="stylesheet" href="/assets/css/form-elements.css">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/media-queries.css">
  <link rel="stylesheet" href="/assets/css/bootstrap-treeview.min.css">
  <script src="/assets/js/jquery-1.12.1.min.js"></script>
  <script src="/assets/js/jquery.backstretch.min.js"></script>
  <script src="/assets/js/jquery.magnific-popup.min.js"></script>
  <script src="/assets/flexslider/jquery.flexslider-min.js"></script>
  <script src="/assets/js/jquery.ui.map.min.js"></script>
  <script src="/assets/js/bootstrap-treeview.min.js"></script>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

  <!-- Favicon and touch icons -->
  <link rel="shortcut icon" href="/assets/ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">

</head>

<body>

  <!-- Presentation -->
  <div class="presentation-container">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 wow fadeInLeftBig">
          <h1>
            <span class="violet">Storia degli Stili</span>
          </h1>
          <p>История стилей.</p>
        </div>
      </div>
    </div>
  </div>


  <!-- Top menu -->
  <nav class="navbar" role="navigation">
    <div class="container offset 10">
      <div class="navbar-header">
        <!--<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#top-navbar-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="/index.php">Библиотека современных стилей</a>
                </div> -->
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="top-navbar-1">
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="../index.html">
                <i class="fa fa-home fa-lg"></i>
                <br>Главная</a>
            </li>
            <li>
              <a href="styles.php">
                <i class="fa fa-camera-retro fa-lg"></i>
                <br>Стили</a>
            </li>
            <li>
              <a href="components.php">
                <i class="glyphicon glyphicon-scissors fa-lg"></i>
                <br>Одежда</a>
            </li>
            <li>
              <a href="signes.html">
                <i class="fa fa-key fa-lg"></i>
                <br>Ключевые признаки</a>
            </li>
            <li>
              <a href="findstyle.html">
                <i class="fa fa-search fa-lg"></i>
                <br>Поиск
                <br>
              </a>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000">
                <i class="fa fa-briefcase fa-lg"></i>
                <br>Кабинет
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="sign-up.php">Регистрация</a>
                </li>
                <li>
                  <a href="login.php">Вход</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
  </nav>

  <!-- Page Title -->
  <div class="page-title-container">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 wow fadeIn">
          <i class="fa fa-key"></i>
          <h1>Signes /
            <p>Ключевые признаки стилей</p>
          </h1>
        </div>
      </div>
    </div>
  </div>

  <script>
    let tree = [];
    let checked = [];
    $(document).ready(function () {
      $.ajax({
        dataType: "json",
        method: 'GET',
        url: '/php/getSignes.php',
      }).done(function (data) {
        console.log('wtf', data);
        // recursive(data.slice(0, 5), null, tree);
        tree = getTree(data, null);
        console.log('tree', tree);
        clearEmptyNodeChilds(tree);
        var options = {
          bootstrap2: false,
          showTags: true,
          levels: 10,
          highlightSelected: false,
          multiSelect: true,
          showCheckbox: true,
          onNodeChecked: function (event, data) {
            if (checked.indexOf(data.id) === -1)
              checked.push(data.id);
            console.log(checked);
          },
          onNodeUnchecked: function (event, data) {
            if (checked.indexOf(data.id) !== -1)
              checked.pop(checked.indexOf(data.id));
            console.log(checked);
          },
          data: tree
        };
        console.log('wtf2', options.data, tree);
        $('#treeview').treeview(options);
      }).error(function (err) {
        console.error(err);
      });

      function getTree(array, parent) {
        let out = array.filter(function (el) {
          return el.parent === parent;
        }).map(function (root) {
          const {
            id,
            name
          } = root;
          // console.log(`el ${id} is leaf for ${parent}`);
          return {
            id,
            text: name,
            state: {
              checked: false,
              disabled: false,
              expanded: false,
              selected: false
            },
            nodes: getTree(array, id),
          };
        });
        return out;
      }

      function clearEmptyNodeChilds(array) {
        $.each(array, function (key, value) {
          if (value.nodes.length !== 0) {
            clearEmptyNodeChilds(value.nodes)
          } else {
            delete value.nodes;
          }
        });
      }

      // $('#treeview').on('nodeChecked', function(event, data) {
      //   console.log(event, data);
      //   // checked.push();
      // });
    });

    function getChecked() {
      var query = checked.join(',');
      $('#result').empty();
      $.getJSON("/php/findSignes.php", {
        ask: query
      }, function (data) { // путь к php поменять
        // console.log('test', data, data[0]);
        var parent = $('#result');
        var li = document.createElement('li');
        var summ = 0;
        $.each(data, function (key, value) {
          summ += Number(value.count);
        });
        console.log(summ);
        $.each(data, function (key, value) {
          value.count = (Number(value.count) / summ * 100).toFixed() + '%';
        });
        console.log(data);
        $.each(data, function (key, value) {
          var li = document.createElement('li'),
            br = document.createElement('br'),
            img = document.createElement('img');
          $(li).addClass('resultItem').text(value.name + ': ' + value.count);
          $(img).attr('src', value.photo).css('height', '150px');
          $(li).append(br).append($(img));
          $(parent).append(li);
        });
      });
    }

    function uncheckAll() {
      $('#result').empty();
      $('#treeview').treeview('uncheckAll', {
        silent: true
      });
      checked = [];
    }
  </script>

  <!-- Meet Our Team -->
  <div class="team-container">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 services-full-width-text wow fadeInLeft">
          <h1>Signes</h1>
        </div>
        <div class="col-sm-6 col-md-6 col-lg-6 services-full-width-text wow fadeInLeft">
          <label for="treeview"></label>
          <div id="treeview" />
        </div>
      </div>
      <div class="col-sm-6">
        <div class="col-sm-6">
          <button class="btn btn-primary" onclick="getChecked();">Выбрать</button>
        </div>
        <div class="col-sm-6">
          <button class="btn btn-primary" onclick="uncheckAll();">Очистить</button>
        </div>
        <div id="result" class="col-sm-12">
          <ul style="list-style: none;">
          </ul>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- Testimonials -->
  <div class="testimonials-container">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 testimonials-title wow fadeIn">
          <h2>Описание</h2>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1 testimonial-list">
          <div role="tabpanel">
            <!-- Tab panes -->
            <div class="tab-content">
              <div role="tabpanel" class="tab-pane fade in active" id="tab1">
                <!--	<div class="testimonial-image">
                                                          <img src="/assets/img/testimonials/1.jpg" alt="" data-at2x="/assets/img/testimonials/1.jpg">
                                                      </div> -->
                <div class="testimonial-text">
                  <p style="font-size: 25px;">
                    В этом разделе Вы можете выбрать одну или несколько ключевых признаков по которым программа определит к какому стилю можно
                    отнести выбранный набор. Результат будет отображен в процентном соотношении. Также под каждым из стилей
                    есть возможность просмотреть какие компоненты стиля принадлежат выбранным ключевым признакам.
                    <br>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Javascript -->
  <script src="/assets/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
  <script src="/assets/js/bootstrap-hover-dropdown.min.js"></script>
  <script src="/assets/js/wow.min.js"></script>
  <script src="/assets/js/retina-1.1.0.min.js"></script>
  <script src="/assets/js/jflickrfeed.min.js"></script>
  <script src="/assets/js/masonry.pkgd.min.js"></script>
  <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script src="/assets/js/scripts.js"></script>

</body>

</html>